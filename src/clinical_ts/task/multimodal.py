from ..template_model import SSLModel
from ..template_modules import TaskConfig
from ..data.time_series_dataset_utils import load_dataset
from pathlib import Path
from dataclasses import dataclass
import numpy as np
import pandas as pd
import warnings

#disable performance warning
warnings.simplefilter(action='ignore', category=pd.errors.PerformanceWarning)

class MultimodalModel(SSLModel):
    '''class for multimodal tasks'''
   
    def preprocess_dataset(self,dataset_kwargs):
        df_mapped, lbl_itos, mean, std = load_dataset(Path(dataset_kwargs.path))

        if(self.hparams.loss.loss_type=="supervised" and dataset_kwargs.name.startswith("mdsed")):
            col_ints = ["Unnamed: 0", "general_study_id", "general_subject_id", "demographics_gender", "general_ecg_no_within_stay", "general_strat_fold", "demographics_ethnicity_asian", "demographics_ethnicity_black/african", "demographics_ethnicity_hispanic/latino", "demographics_ethnicity_other", "demographics_ethnicity_white", "diagnoses_i10", "diagnoses_e78", "diagnoses_z79", "diagnoses_e785", "diagnoses_e11", "diagnoses_i25", "diagnoses_r07", "diagnoses_i251", "diagnoses_z87", "diagnoses_i2510", "diagnoses_i50", "diagnoses_z878", "diagnoses_i48", "diagnoses_z8789", "diagnoses_k21", "diagnoses_k219", "diagnoses_e87", "diagnoses_n18", "diagnoses_e119", "diagnoses_z790", "diagnoses_n17", "diagnoses_i489", "diagnoses_i4891", "diagnoses_n179", "diagnoses_y92", "diagnoses_f32", "diagnoses_f329", "diagnoses_r079", "diagnoses_z86", "diagnoses_i12", "diagnoses_z7901", "diagnoses_z95", "diagnoses_z867", "diagnoses_f41", "diagnoses_z85", "diagnoses_z794", "diagnoses_f419", "diagnoses_e03", "diagnoses_i509", "diagnoses_e039", "diagnoses_j44", "diagnoses_g47", "diagnoses_r00", "diagnoses_d64", "diagnoses_i503", "diagnoses_i129", "diagnoses_d649", "diagnoses_f172", "diagnoses_f17", "diagnoses_z66", "diagnoses_n39", "diagnoses_e780", "diagnoses_n390", "diagnoses_r078", "diagnoses_z798", "diagnoses_e66", "diagnoses_z68", "diagnoses_j45", "diagnoses_r0789", "diagnoses_j459", "diagnoses_r10", "diagnoses_e86", "diagnoses_j449", "diagnoses_i95", "diagnoses_g473", "diagnoses_i252", "diagnoses_r55", "diagnoses_i502", "diagnoses_n189", "diagnoses_z7982", "diagnoses_f10", "diagnoses_g4733", "diagnoses_j96", "diagnoses_z98", "diagnoses_z91", "diagnoses_m54", "diagnoses_r06", "diagnoses_z8671", "diagnoses_g89", "diagnoses_e871", "diagnoses_e872", "diagnoses_j18", "diagnoses_n40", "diagnoses_e669", "diagnoses_j189", "diagnoses_z8673", "diagnoses_z951", "diagnoses_d69", "diagnoses_i21", "diagnoses_f1720", "diagnoses_a41", "diagnoses_k59", "diagnoses_r42", "diagnoses_k590", "diagnoses_r11", "diagnoses_g892", "diagnoses_g8929", "diagnoses_e112", "diagnoses_e860", "diagnoses_j4590", "diagnoses_d63", "diagnoses_z7902", "diagnoses_m10", "diagnoses_z99", "diagnoses_n400", "diagnoses_e875", "diagnoses_y920", "diagnoses_d72", "diagnoses_i27", "diagnoses_m109", "diagnoses_n183", "diagnoses_z986", "diagnoses_z9861", "diagnoses_r001", "diagnoses_b96", "diagnoses_m79", "diagnoses_k5900", "diagnoses_d62", "diagnoses_m81", "diagnoses_d728", "diagnoses_r060", "diagnoses_m810", "diagnoses_i5032", "diagnoses_y929", "diagnoses_n186", "diagnoses_i5033", "diagnoses_e116", "diagnoses_g93", "diagnoses_r09", "diagnoses_d50", "diagnoses_y83", "diagnoses_r19", "diagnoses_f101", "diagnoses_d696", "diagnoses_r53", "diagnoses_g40", "diagnoses_i13", "diagnoses_r090", "diagnoses_r0902", "diagnoses_e83", "diagnoses_f03", "diagnoses_f039", "diagnoses_a419", "diagnoses_d7282", "diagnoses_r65", "diagnoses_m19", "diagnoses_r51", "diagnoses_i214", "diagnoses_f0390", "diagnoses_i959", "diagnoses_z90", "diagnoses_r652", "diagnoses_f1721", "diagnoses_m199", "diagnoses_e1122", "diagnoses_m1990", "diagnoses_e876", "diagnoses_z858", "diagnoses_r197", "diagnoses_z911", "diagnoses_z96", "diagnoses_e114", "diagnoses_r101", "diagnoses_z955", "diagnoses_y922", "diagnoses_y84", "diagnoses_k76", "diagnoses_i11", "diagnoses_i73", "diagnoses_f102", "diagnoses_i120", "diagnoses_y9223", "diagnoses_i42", "diagnoses_f1010", "diagnoses_z854", "diagnoses_r002", "diagnoses_g470", "diagnoses_g4700", "diagnoses_z992", "diagnoses_i5023", "diagnoses_i110", "diagnoses_d509", "diagnoses_g92", "diagnoses_i47", "diagnoses_z683", "diagnoses_w18", "diagnoses_j4599", "diagnoses_j960", "diagnoses_z23", "diagnoses_z966", "diagnoses_i5022", "diagnoses_e88", "diagnoses_m25", "diagnoses_i739", "diagnoses_z918", "diagnoses_h40", "diagnoses_z9181", "diagnoses_r33", "diagnoses_i130", "diagnoses_j441", "diagnoses_z950", "diagnoses_d631", "diagnoses_i480", "diagnoses_j969", "diagnoses_d68", "diagnoses_r41", "diagnoses_r79", "diagnoses_i69", "diagnoses_m255", "diagnoses_r112", "diagnoses_e1165", "diagnoses_e861", "diagnoses_g409", "diagnoses_e7800", "diagnoses_g4090", "diagnoses_r000", "diagnoses_z8582", "diagnoses_k92", "diagnoses_i34", "diagnoses_h409", "diagnoses_r74", "diagnoses_e1140", "diagnoses_r13", "diagnoses_k31", "diagnoses_r131", "diagnoses_i44", "diagnoses_i35", "diagnoses_e870", "diagnoses_m549", "diagnoses_r6521", "diagnoses_j98", "diagnoses_z684", "diagnoses_j9601", "diagnoses_r538", "diagnoses_i278", "diagnoses_g934", "diagnoses_c78", "diagnoses_r109", "diagnoses_z82", "diagnoses_i951", "diagnoses_z8546", "diagnoses_r791", "diagnoses_c79", "diagnoses_z9665", "diagnoses_r50", "diagnoses_r0602", "diagnoses_r1013", "diagnoses_z78", "diagnoses_z781", "diagnoses_e10", "diagnoses_r05", "diagnoses_j9690", "diagnoses_i272", "diagnoses_y9200", "diagnoses_z824", "diagnoses_r6520", "diagnoses_e113", "diagnoses_r5383", "diagnoses_r29", "diagnoses_z92", "diagnoses_k74", "diagnoses_r47", "diagnoses_j69", "diagnoses_k318", "diagnoses_j690", "diagnoses_k57", "diagnoses_g43", "diagnoses_i2789", "diagnoses_b962", "diagnoses_z8249", "diagnoses_r91", "diagnoses_i63", "diagnoses_f31", "diagnoses_b19", "diagnoses_b95", "diagnoses_z850", "diagnoses_r339", "diagnoses_e660", "diagnoses_m796", "diagnoses_m545", "diagnoses_e6601", "diagnoses_k746", "diagnoses_e888", "diagnoses_y921", "diagnoses_y9209", "diagnoses_e13", "diagnoses_r103", "diagnoses_z682", "diagnoses_w183", "diagnoses_i4892", "diagnoses_k70", "diagnoses_k22", "diagnoses_r0600", "diagnoses_r740", "diagnoses_r1310", "diagnoses_i82", "diagnoses_j91", "diagnoses_e1131", "diagnoses_r068", "diagnoses_z988", "diagnoses_v43", "diagnoses_y848", "diagnoses_r57", "diagnoses_t82", "diagnoses_z9119", "diagnoses_m48", "diagnoses_b192", "diagnoses_k29", "diagnoses_f319", "diagnoses_r20", "diagnoses_r298", "diagnoses_g439", "diagnoses_g4390", "diagnoses_r418", "diagnoses_b1920", "diagnoses_r110", "diagnoses_e8889", "diagnoses_e134", "diagnoses_e1342", "diagnoses_i26", "diagnoses_v17", "diagnoses_r509", "diagnoses_z51", "diagnoses_c34", "diagnoses_n170", "diagnoses_i269", "diagnoses_r0689", "diagnoses_s06", "diagnoses_l03", "diagnoses_r4182", "diagnoses_k573", "diagnoses_f11", "diagnoses_f43", "diagnoses_f05", "diagnoses_z958", "diagnoses_f028", "diagnoses_f02", "diagnoses_m480", "diagnoses_z515", "diagnoses_k703", "diagnoses_z922", "diagnoses_y9219", "diagnoses_i472", "diagnoses_r18", "diagnoses_z9221", "diagnoses_v10", "diagnoses_i428", "diagnoses_d638", "diagnoses_e55", "diagnoses_e559", "diagnoses_e833", "diagnoses_e8339", "diagnoses_l89", "diagnoses_m7960", "diagnoses_i87", "diagnoses_r45", "diagnoses_i2699", "diagnoses_v103", "diagnoses_n184", "diagnoses_i45", "diagnoses_z795", "diagnoses_r63", "diagnoses_r26", "diagnoses_z7952", "diagnoses_k7469", "diagnoses_r531", "diagnoses_w1830", "diagnoses_m06", "diagnoses_v173", "diagnoses_t45", "diagnoses_d61", "diagnoses_z9581", "diagnoses_f0280", "diagnoses_v46", "diagnoses_g25", "diagnoses_i699", "diagnoses_i348", "diagnoses_e46", "diagnoses_d618", "diagnoses_i71", "diagnoses_d6181", "diagnoses_r94", "diagnoses_k766", "diagnoses_i471", "diagnoses_i67", "diagnoses_k80", "diagnoses_a04", "diagnoses_b37", "diagnoses_i08", "diagnoses_e835", "diagnoses_r188", "diagnoses_z855", "diagnoses_x58", "diagnoses_i20", "diagnoses_b18", "diagnoses_j981", "diagnoses_r31", "diagnoses_m069", "diagnoses_a047", "diagnoses_i24", "diagnoses_y838", "diagnoses_i2511", "diagnoses_e43", "diagnoses_s22", "diagnoses_s01", "diagnoses_v15", "diagnoses_z874", "diagnoses_r56", "diagnoses_z8744", "diagnoses_z998", "diagnoses_z9981", "diagnoses_m2551", "diagnoses_r569", "diagnoses_r60", "diagnoses_l97", "diagnoses_k56", "diagnoses_d6959", "diagnoses_d695", "diagnoses_j918", "diagnoses_g9340", "diagnoses_j06", "diagnoses_j069", "diagnoses_n401", "diagnoses_m797", "diagnoses_f431", "diagnoses_j15", "diagnoses_v153", "diagnoses_i248", "diagnoses_i359", "diagnoses_r40", "diagnoses_f1020", "diagnoses_f14", "diagnoses_i958", "diagnoses_r911", "diagnoses_i70", "diagnoses_i85", "diagnoses_c795", "diagnoses_k52", "diagnoses_l031", "diagnoses_i49", "diagnoses_z853", "diagnoses_g20", "diagnoses_k86", "diagnoses_z94", "diagnoses_h54", "diagnoses_g30", "diagnoses_k72", "diagnoses_f1023", "diagnoses_g81", "diagnoses_h53", "diagnoses_m47", "diagnoses_e877", "diagnoses_m62", "diagnoses_l891", "diagnoses_k7030", "diagnoses_r73", "diagnoses_c787", "diagnoses_z89", "diagnoses_i693", "diagnoses_m94", "diagnoses_e834", "diagnoses_l8915", "diagnoses_g309", "diagnoses_k44", "diagnoses_m628", "diagnoses_v462", "diagnoses_i31", "diagnoses_z8503", "diagnoses_e1129", "diagnoses_g62", "diagnoses_k921", "diagnoses_w19", "diagnoses_b182", "diagnoses_k449", "diagnoses_z7989", "diagnoses_r62", "diagnoses_r634", "diagnoses_r2981", "diagnoses_i504", "diagnoses_k5730", "diagnoses_k64", "diagnoses_r32", "diagnoses_g819", "diagnoses_z21", "diagnoses_r458", "diagnoses_z6841", "diagnoses_b968", "diagnoses_i65", "diagnoses_z904", "diagnoses_r1030", "diagnoses_r4585", "diagnoses_b9629", "diagnoses_i851", "diagnoses_z860", "diagnoses_g936", "diagnoses_v42", "diagnoses_k922", "diagnoses_r627", "diagnoses_m542", "diagnoses_r943", "diagnoses_c780", "diagnoses_r209", "diagnoses_i872", "diagnoses_d47", "diagnoses_a415", "diagnoses_i447", "diagnoses_z8601", "diagnoses_k3184", "diagnoses_z9114", "diagnoses_j90", "diagnoses_b9620", "diagnoses_v66", "diagnoses_i51", "diagnoses_v667", "diagnoses_i824", "diagnoses_z861", "diagnoses_j84", "diagnoses_j81", "diagnoses_c77", "diagnoses_k83", "diagnoses_r470", "diagnoses_i340", "diagnoses_z9049", "diagnoses_e04", "diagnoses_v436", "diagnoses_t50", "diagnoses_s09", "diagnoses_i258", "diagnoses_r4701", "diagnoses_h91", "diagnoses_n13", "diagnoses_z851", "diagnoses_e873", "diagnoses_t86", "diagnoses_k85", "diagnoses_z8511", "diagnoses_z9884", "diagnoses_t40", "diagnoses_i652", "diagnoses_i61", "diagnoses_r04", "diagnoses_z80", "diagnoses_i482", "diagnoses_d689", "diagnoses_i8510", "diagnoses_r471", "diagnoses_z93", "diagnoses_i6999", "diagnoses_i350", "diagnoses_e106", "diagnoses_r570", "diagnoses_i07", "diagnoses_m798", "diagnoses_g9341", "diagnoses_r78", "diagnoses_h919", "diagnoses_t81", "diagnoses_g629", "diagnoses_r9431", "diagnoses_f141", "diagnoses_m35", "diagnoses_e1169", "diagnoses_e53", "diagnoses_v4364", "diagnoses_z72", "diagnoses_t828", "diagnoses_i255", "diagnoses_h81", "diagnoses_f12", "diagnoses_z9889", "diagnoses_m478", "diagnoses_e538", "diagnoses_i634", "diagnoses_g31", "diagnoses_r730", "diagnoses_m949", "diagnoses_w184", "diagnoses_w1849", "diagnoses_g258", "diagnoses_j95", "diagnoses_d53", "diagnoses_k75", "diagnoses_d500", "diagnoses_r918", "diagnoses_g60", "diagnoses_k63", "diagnoses_b9689", "diagnoses_h35", "diagnoses_y832", "diagnoses_i46", "diagnoses_e27", "diagnoses_j962", "diagnoses_r609", "diagnoses_r82", "diagnoses_y928", "diagnoses_r269", "diagnoses_j43", "diagnoses_f112", "diagnoses_d539", "diagnoses_b20", "diagnoses_g2581", "diagnoses_z871", "diagnoses_i132", "diagnoses_i259", "diagnoses_f1410", "diagnoses_t38", "diagnoses_k62", "diagnoses_z952", "diagnoses_v44", "diagnoses_z00", "diagnoses_z9664", "diagnoses_z006", "diagnoses_k729", "diagnoses_c349", "diagnoses_r338", "diagnoses_k529", "diagnoses_z681", "diagnoses_c793", "diagnoses_t42", "diagnoses_h9190", "diagnoses_i2720", "diagnoses_z45", "diagnoses_e22", "diagnoses_e115", "diagnoses_f20", "diagnoses_m4800", "diagnoses_c7931", "diagnoses_r788", "diagnoses_s224", "diagnoses_m17", "diagnoses_j439", "diagnoses_d684", "diagnoses_r1011", "diagnoses_n28", "diagnoses_r7881", "diagnoses_s72", "diagnoses_i702", "diagnoses_b952", "diagnoses_k227", "diagnoses_k58", "diagnoses_k2270", "diagnoses_z450", "diagnoses_k768", "diagnoses_c7800", "diagnoses_e222", "diagnoses_g609", "diagnoses_z907", "diagnoses_i5021", "diagnoses_y9289", "diagnoses_i200", "diagnoses_r2989", "diagnoses_f19", "diagnoses_a08", "diagnoses_n08", "diagnoses_k859", "diagnoses_k3189", "diagnoses_i6935", "diagnoses_z720", "diagnoses_f1021", "diagnoses_i714", "diagnoses_s099", "diagnoses_c3490", "diagnoses_s065", "diagnoses_i9581", "diagnoses_e89", "diagnoses_e1151", "diagnoses_k20", "diagnoses_t451", "diagnoses_h353", "diagnoses_j9819", "diagnoses_b961", "diagnoses_z8551", "diagnoses_i080", "diagnoses_r64", "diagnoses_l40", "diagnoses_i451", "diagnoses_v433", "diagnoses_i4510", "diagnoses_s0990", "diagnoses_m4781", "diagnoses_v16", "diagnoses_m7989", "diagnoses_g318", "diagnoses_k7689", "diagnoses_j958", "diagnoses_f4310", "diagnoses_e05", "diagnoses_e1139", "diagnoses_t861", "diagnoses_e880", "diagnoses_k55", "diagnoses_i469", "diagnoses_e8342", "diagnoses_r319", "diagnoses_y830", "diagnoses_g893", "diagnoses_i5043", "diagnoses_v85", "diagnoses_z8711", "diagnoses_f111", "diagnoses_e21", "diagnoses_r401", "diagnoses_b956", "diagnoses_l0312", "diagnoses_k589", "diagnoses_e1121", "diagnoses_d70", "diagnoses_r111", "diagnoses_r748", "diagnoses_e890", "diagnoses_j159", "diagnoses_k25", "diagnoses_h3530", "diagnoses_i078", "diagnoses_k50", "diagnoses_i5031", "diagnoses_e1065", "diagnoses_e104", "diagnoses_j9811", "diagnoses_c61", "diagnoses_r25", "diagnoses_t46", "diagnoses_k5909", "diagnoses_e1164", "diagnoses_i16", "diagnoses_z8552", "diagnoses_i5030", "diagnoses_e8809", "diagnoses_d648", "diagnoses_k648", "diagnoses_i97", "diagnoses_s02", "diagnoses_e8351", "diagnoses_f1120", "diagnoses_c7951", "diagnoses_f1110", "diagnoses_e8779", "diagnoses_m353", "diagnoses_y831", "diagnoses_c25", "diagnoses_i442", "diagnoses_e8352", "diagnoses_v70", "diagnoses_v707", "diagnoses_k299", "diagnoses_i429", "diagnoses_m2556", "diagnoses_z894", "diagnoses_t455", "diagnoses_i77", "diagnoses_j11", "diagnoses_z6842", "diagnoses_t83", "diagnoses_z923", "diagnoses_r21", "diagnoses_e109", "diagnoses_n99", "diagnoses_i6529", "diagnoses_e874", "diagnoses_i319", "diagnoses_j811", "diagnoses_i635", "diagnoses_g4730", "diagnoses_t380", "diagnoses_c7952", "diagnoses_t43", "diagnoses_a4151", "diagnoses_f1012", "diagnoses_r0781", "diagnoses_k65", "diagnoses_f01", "diagnoses_f015", "diagnoses_i21a", "diagnoses_i21a1", "diagnoses_c90", "diagnoses_r68", "diagnoses_m2555", "diagnoses_c900", "diagnoses_s066", "diagnoses_h26", "diagnoses_z7984", "diagnoses_m32", "diagnoses_e1142", "diagnoses_f1022", "diagnoses_e041", "diagnoses_b378", "diagnoses_f90", "diagnoses_e274", "diagnoses_n31", "diagnoses_f4312", "diagnoses_z8674", "diagnoses_b97", "diagnoses_k861", "diagnoses_z905", "diagnoses_z9071", "diagnoses_m6282", "diagnoses_k566", "diagnoses_k2990", "diagnoses_e102", "diagnoses_i678", "diagnoses_j910", "diagnoses_h269", "diagnoses_f209", "diagnoses_d630", "diagnoses_n25", "diagnoses_k91", "diagnoses_n998", "diagnoses_f909", "diagnoses_k567", "diagnoses_i6340", "diagnoses_l0311", "diagnoses_j111", "diagnoses_t4551", "diagnoses_j9691", "diagnoses_m85", "diagnoses_m858", "diagnoses_s00", "diagnoses_k625", "diagnoses_k830", "diagnoses_s42", "diagnoses_c22", "diagnoses_y846", "diagnoses_e8770", "diagnoses_t8612", "diagnoses_l975", "diagnoses_q21", "diagnoses_v60", "diagnoses_m4806", "diagnoses_v45", "diagnoses_d7281", "diagnoses_z857", "diagnoses_k7290", "diagnoses_z901", "diagnoses_r508", "diagnoses_k297", "diagnoses_r59", "diagnoses_n182", "diagnoses_d86", "diagnoses_r7309", "diagnoses_z940", "diagnoses_b9789", "diagnoses_b978", "diagnoses_m8580", "diagnoses_w01", "diagnoses_e103", "diagnoses_i6350", "diagnoses_i672", "diagnoses_d472", "diagnoses_s32", "diagnoses_r798", "diagnoses_h548", "diagnoses_k26", "diagnoses_f0150", "diagnoses_n20", "diagnoses_n133", "diagnoses_i2582", "diagnoses_j9600", "diagnoses_n258", "diagnoses_r829", "diagnoses_i9589", "diagnoses_k802", "diagnoses_k509", "diagnoses_i619", "diagnoses_q211", "diagnoses_i458", "diagnoses_r072", "diagnoses_r200", "diagnoses_m12", "diagnoses_c9000", "diagnoses_r451", "diagnoses_s010", "diagnoses_j30", "diagnoses_r410", "diagnoses_r7989", "diagnoses_k8020", "diagnoses_r8299", "diagnoses_s10", "diagnoses_z59", "diagnoses_m541", "diagnoses_k5090", "diagnoses_z6843", "diagnoses_g35", "diagnoses_n319", "diagnoses_r03", "diagnoses_s109", "diagnoses_c91", "diagnoses_k920", "diagnoses_c50", "diagnoses_e16", "diagnoses_j9621", "diagnoses_f25", "diagnoses_t80", "diagnoses_z908", "diagnoses_i209", "diagnoses_f410", "diagnoses_j848", "diagnoses_n1330", "diagnoses_e213", "diagnoses_k7460", "diagnoses_z993", "diagnoses_e2740", "diagnoses_n9982", "diagnoses_t36", "diagnoses_m129", "diagnoses_n185", "diagnoses_i211", "diagnoses_m179", "diagnoses_z8619", "diagnoses_k209", "diagnoses_j8489", "diagnoses_c786", "diagnoses_m86", "diagnoses_z590", "diagnoses_d473", "diagnoses_t835", "diagnoses_j980", "diagnoses_e1040", "diagnoses_k7031", "diagnoses_i4581", "diagnoses_t814", "diagnoses_k2970", "diagnoses_z16", "diagnoses_v600", "diagnoses_m84", "diagnoses_t8351", "diagnoses_f129", "diagnoses_v422", "diagnoses_r578", "diagnoses_d46", "diagnoses_i978", "diagnoses_s018", "diagnoses_h538", "diagnoses_n2581", "diagnoses_k701", "diagnoses_e44", "diagnoses_i5020", "diagnoses_z8585", "diagnoses_g935", "diagnoses_i441", "diagnoses_r27", "diagnoses_k831", "diagnoses_c798", "diagnoses_i6939", "diagnoses_t829", "diagnoses_z8782", "diagnoses_e85", "diagnoses_r040", "diagnoses_j47", "diagnoses_c341", "diagnoses_r600", "diagnoses_j9585", "diagnoses_m51", "diagnoses_k635", "diagnoses_f199", "diagnoses_i2581", "diagnoses_r402", "diagnoses_f259", "diagnoses_c85", "diagnoses_k758", "diagnoses_z948", "diagnoses_e8349", "diagnoses_z4501", "diagnoses_r1032", "diagnoses_r310", "diagnoses_d469", "diagnoses_k51", "diagnoses_g3184", "diagnoses_r268", "diagnoses_z8942", "diagnoses_t85", "diagnoses_r195", "diagnoses_e869", "diagnoses_d721", "diagnoses_f39", "diagnoses_z76", "diagnoses_i6995", "diagnoses_r478", "diagnoses_h811", "diagnoses_z870", "diagnoses_j440", "diagnoses_w1839", "diagnoses_f1290", "diagnoses_j9602", "diagnoses_n289", "diagnoses_t424", "diagnoses_k7581", "diagnoses_y924", "diagnoses_f60", "diagnoses_j984", "diagnoses_f18", "diagnoses_f181", "diagnoses_f1810", "diagnoses_c509", "diagnoses_j810", "diagnoses_e162", "diagnoses_d869", "diagnoses_l27", "diagnoses_c911", "diagnoses_n32", "diagnoses_i160", "diagnoses_l98", "diagnoses_z8701", "diagnoses_b9561", "diagnoses_r030", "diagnoses_k918", "diagnoses_v420", "diagnoses_i210", "diagnoses_c5091", "diagnoses_d686", "diagnoses_z895", "diagnoses_r630", "diagnoses_g8194", "diagnoses_z7682", "diagnoses_z768", "diagnoses_d709", "diagnoses_j94", "diagnoses_n30", "diagnoses_k3181", "diagnoses_v160", "diagnoses_z8951", "diagnoses_b965", "diagnoses_r35", "diagnoses_t39", "diagnoses_y9201", "diagnoses_v49", "diagnoses_c7989", "diagnoses_f121", "diagnoses_g91", "diagnoses_f50", "diagnoses_s2249", "diagnoses_f29", "diagnoses_i313", "diagnoses_j9809", "diagnoses_b02", "diagnoses_s82", "diagnoses_i878", "diagnoses_c771", "diagnoses_r5081", "diagnoses_e440", "diagnoses_k760", "diagnoses_k5660", "diagnoses_j20", "diagnoses_n200", "diagnoses_i518", "diagnoses_i826", "diagnoses_z9010", "diagnoses_r1312", "diagnoses_m321", "diagnoses_i2109", "diagnoses_c9110", "diagnoses_t44", "diagnoses_i81", "diagnoses_r1031", "diagnoses_f33", "diagnoses_t17", "diagnoses_e662", "diagnoses_i081", "diagnoses_b34", "diagnoses_f1210", "diagnoses_r688", "diagnoses_i952", "diagnoses_i2119", "diagnoses_t402", "diagnoses_m543", "diagnoses_s12", "diagnoses_d57", "diagnoses_i74", "diagnoses_t78", "diagnoses_g408", "diagnoses_i62", "diagnoses_g90", "diagnoses_i440", "diagnoses_d6481", "diagnoses_v454", "diagnoses_z9089", "diagnoses_l29", "diagnoses_j02", "diagnoses_g82", "diagnoses_i7020", "diagnoses_z8542", "diagnoses_k720", "diagnoses_b349", "diagnoses_k7010", "diagnoses_r579", "diagnoses_w10", "diagnoses_v851", "diagnoses_w06", "diagnoses_c83", "diagnoses_r22", "diagnoses_v463", "diagnoses_j948", "diagnoses_z6832", "diagnoses_c92", "diagnoses_j32", "diagnoses_i6992", "diagnoses_g938", "diagnoses_j309", "diagnoses_w010", "diagnoses_o99", "diagnoses_r1012", "diagnoses_k7200", "diagnoses_y9212", "diagnoses_a418", "diagnoses_b964", "diagnoses_a088", "diagnoses_c858", "diagnoses_z8781", "diagnoses_v850", "diagnoses_j841", "diagnoses_e059", "diagnoses_a084", "diagnoses_k762", "diagnoses_i710", "diagnoses_k519", "diagnoses_i9789", "diagnoses_e0590", "diagnoses_j479", "diagnoses_k7291", "diagnoses_k259", "diagnoses_z953", "diagnoses_z8614", "diagnoses_z4502", "diagnoses_y93", "diagnoses_g8191", "diagnoses_a410", "diagnoses_k5190", "diagnoses_b370", "diagnoses_i60", "diagnoses_k868", "diagnoses_a40", "diagnoses_f432", "diagnoses_j029", "diagnoses_r30", "diagnoses_l974", "diagnoses_m5430", "diagnoses_k90", "diagnoses_h544", "diagnoses_b181", "diagnoses_y9241", "diagnoses_i490", "diagnoses_s20", "diagnoses_k27", "diagnoses_t802", "diagnoses_k298", "diagnoses_n394", "diagnoses_r1112", "diagnoses_k579", "diagnoses_i4901", "diagnoses_d51", "diagnoses_b3783", "diagnoses_y842", "diagnoses_j209", "diagnoses_z6831", "diagnoses_s1093", "diagnoses_m31", "diagnoses_s721", "diagnoses_r76", "diagnoses_z6839", "diagnoses_i5042", "diagnoses_n12", "diagnoses_g931", "diagnoses_m3210", "diagnoses_z6836", "diagnoses_z6837", "diagnoses_t8021", "diagnoses_b00", "diagnoses_r34", "diagnoses_r599", "diagnoses_k43", "diagnoses_z931", "diagnoses_i30", "diagnoses_m4802", "diagnoses_r042", "diagnoses_n328", "diagnoses_i420", "diagnoses_r739", "diagnoses_k222", "diagnoses_y840", "diagnoses_i620", "diagnoses_k279", "diagnoses_z6833", "diagnoses_s27", "diagnoses_g894", "diagnoses_v18", "diagnoses_z83", "diagnoses_v14", "diagnoses_n52", "diagnoses_k66", "diagnoses_r827", "diagnoses_e1022", "diagnoses_n529", "diagnoses_r2681", "diagnoses_l299", "diagnoses_t8286", "diagnoses_s202", "diagnoses_g45", "diagnoses_v441", "diagnoses_r93", "diagnoses_t8289", "diagnoses_h534", "diagnoses_k224", "diagnoses_r350", "diagnoses_e050", "diagnoses_a4159", "diagnoses_k2980", "diagnoses_m16", "diagnoses_s220", "diagnoses_z6830", "diagnoses_r259", "diagnoses_d75", "diagnoses_r7303", "diagnoses_r413", "diagnoses_l9750", "diagnoses_s52", "diagnoses_j329", "diagnoses_z6835", "diagnoses_r61", "diagnoses_e0500", "diagnoses_s320", "diagnoses_i89", "diagnoses_j40", "diagnoses_b191", "diagnoses_s720", "diagnoses_z6834", "diagnoses_z791", "diagnoses_z6838", "diagnoses_r4789", "diagnoses_d6489", "diagnoses_t8285", "diagnoses_e042", "diagnoses_l408", "diagnoses_j93", "diagnoses_b9562", "diagnoses_l25", "diagnoses_r8271", "diagnoses_z162", "diagnoses_r297", "diagnoses_g3183", "diagnoses_g9389", "diagnoses_g58", "diagnoses_j9620", "diagnoses_j152", "diagnoses_d683", "diagnoses_k254", "diagnoses_b1910", "diagnoses_i071", "diagnoses_s7214", "diagnoses_j38", "diagnoses_k5731", "diagnoses_r414", "diagnoses_s2021", "diagnoses_m21", "diagnoses_z944", "diagnoses_s223", "diagnoses_z9079", "diagnoses_k5732", "diagnoses_o992", "diagnoses_s80", "diagnoses_k81", "diagnoses_z804", "diagnoses_m6281", "diagnoses_i495", "diagnoses_j961", "diagnoses_i824y", "diagnoses_i5181", "diagnoses_c8589", "diagnoses_v180", "diagnoses_h532", "diagnoses_d89", "diagnoses_m940", "diagnoses_d56", "diagnoses_i72", "diagnoses_c772", "diagnoses_d80", "diagnoses_g589", "diagnoses_i213", "diagnoses_v498", "diagnoses_k900", "diagnoses_j1521", "diagnoses_i712", "diagnoses_j39", "diagnoses_i80", "diagnoses_i7300", "diagnoses_i730", "diagnoses_i639", "diagnoses_h813", "diagnoses_e8881", "diagnoses_c259", "diagnoses_k761", "diagnoses_r279", "diagnoses_e1031", "diagnoses_t426", "diagnoses_z981", "diagnoses_e118", "diagnoses_e1162", "diagnoses_r1110", "diagnoses_i6784", "diagnoses_i8241", "diagnoses_r15", "diagnoses_g4080", "diagnoses_d6832", "diagnoses_o9928", "diagnoses_i6932", "diagnoses_v4988", "diagnoses_a4189", "diagnoses_i422", "diagnoses_q61", "diagnoses_l033", "diagnoses_i33", "diagnoses_i824z", "diagnoses_z902", "diagnoses_i481", "diagnoses_t501", "diagnoses_f34", "diagnoses_g8190", "diagnoses_m41", "diagnoses_r159", "diagnoses_i517", "diagnoses_l259", "diagnoses_z8505", "diagnoses_f500", "diagnoses_g403", "diagnoses_k649", "diagnoses_z8504", "diagnoses_r312", "diagnoses_z53", "diagnoses_s0180", "diagnoses_g51", "diagnoses_f13", "diagnoses_k644", "diagnoses_i890", "diagnoses_m1a", "diagnoses_h57", "diagnoses_g44", "diagnoses_h8139", "diagnoses_b35", "diagnoses_s0100", "diagnoses_s0101", "diagnoses_c80", "diagnoses_c64", "diagnoses_z3a", "diagnoses_i609", "diagnoses_k521", "diagnoses_i330", "diagnoses_f341", "diagnoses_f603", "diagnoses_r761", "diagnoses_g822", "diagnoses_e878", "diagnoses_i519", "diagnoses_r108", "diagnoses_k264", "diagnoses_r7611", "diagnoses_c18", "diagnoses_m1a9", "diagnoses_i161", "diagnoses_c343", "diagnoses_e80", "diagnoses_k208", "diagnoses_t432", "diagnoses_s008", "diagnoses_z6829", "diagnoses_h90", "diagnoses_e1143", "diagnoses_g57", "diagnoses_s063", "diagnoses_k9189", "diagnoses_s70", "diagnoses_t508", "diagnoses_z800", "diagnoses_z22", "diagnoses_s30", "diagnoses_l271", "diagnoses_l978", "diagnoses_l893", "diagnoses_g8220", "diagnoses_t88", "diagnoses_m100", "diagnoses_b9681", "diagnoses_c67", "diagnoses_n05", "diagnoses_f339", "diagnoses_g4030", "diagnoses_d6862", "diagnoses_l896", "diagnoses_z88", "diagnoses_m6283", "diagnoses_f411", "diagnoses_g252", "diagnoses_g510", "diagnoses_z9112", "diagnoses_b954", "diagnoses_l409", "diagnoses_z74", "diagnoses_t447", "diagnoses_k838", "diagnoses_t509", "diagnoses_c801", "diagnoses_s022", "diagnoses_c228", "diagnoses_e1069", "diagnoses_s098", "diagnoses_g891", "diagnoses_k317", "diagnoses_r180", "diagnoses_a0472", "diagnoses_e781", "diagnoses_y836", "diagnoses_g70", "diagnoses_r39", "diagnoses_m8468", "diagnoses_m846", "diagnoses_z77", "diagnoses_d59", "diagnoses_r52", "diagnoses_v163", "diagnoses_c71", "diagnoses_h401", "diagnoses_g56", "diagnoses_r4023", "diagnoses_z964", "diagnoses_z9641", "diagnoses_c797", "diagnoses_m7966", "diagnoses_c16", "diagnoses_z803", "diagnoses_k5790", "diagnoses_k800", "general_data"]
            col_floats = ["general_ed_stay_id", "general_ed_hadm_id", "demographics_age", "general_anchor_year", "general_anchor_age", "general_mortality_hours", "general_mortality_days", "general_icu_time_hours", "biometrics_bmi", "biometrics_weight", "biometrics_height", "vitals_temperature_mean", "vitals_temperature_median", "vitals_temperature_min", "vitals_temperature_max", "vitals_temperature_std", "vitals_temperature_first", "vitals_temperature_last", "vitals_temperature_rate_change", "vitals_temperature_coeff", "vitals_heartrate_mean", "vitals_heartrate_median", "vitals_heartrate_min", "vitals_heartrate_max", "vitals_heartrate_std", "vitals_heartrate_first", "vitals_heartrate_last", "vitals_heartrate_rate_change", "vitals_heartrate_coeff", "vitals_resprate_mean", "vitals_resprate_median", "vitals_resprate_min", "vitals_resprate_max", "vitals_resprate_std", "vitals_resprate_first", "vitals_resprate_last", "vitals_resprate_rate_change", "vitals_resprate_coeff", "vitals_o2sat_mean", "vitals_o2sat_median", "vitals_o2sat_min", "vitals_o2sat_max", "vitals_o2sat_std", "vitals_o2sat_first", "vitals_o2sat_last", "vitals_o2sat_rate_change", "vitals_o2sat_coeff", "vitals_sbp_mean", "vitals_sbp_median", "vitals_sbp_min", "vitals_sbp_max", "vitals_sbp_std", "vitals_sbp_first", "vitals_sbp_last", "vitals_sbp_rate_change", "vitals_sbp_coeff", "vitals_dbp_mean", "vitals_dbp_median", "vitals_dbp_min", "vitals_dbp_max", "vitals_dbp_std", "vitals_dbp_first", "vitals_dbp_last", "vitals_dbp_rate_change", "vitals_dbp_coeff", "vitals_acuity", "labvalues_absolute_basophil_count_mean", "labvalues_absolute_basophil_count_median", "labvalues_absolute_basophil_count_min", "labvalues_absolute_basophil_count_max", "labvalues_absolute_basophil_count_std", "labvalues_absolute_basophil_count_first", "labvalues_absolute_basophil_count_last", "labvalues_absolute_basophil_count_rate_change", "labvalues_absolute_basophil_count_coeff", "labvalues_absolute_eosinophil_count_mean", "labvalues_absolute_eosinophil_count_median", "labvalues_absolute_eosinophil_count_min", "labvalues_absolute_eosinophil_count_max", "labvalues_absolute_eosinophil_count_std", "labvalues_absolute_eosinophil_count_first", "labvalues_absolute_eosinophil_count_last", "labvalues_absolute_eosinophil_count_rate_change", "labvalues_absolute_eosinophil_count_coeff", "labvalues_absolute_lymphocyte_count_mean", "labvalues_absolute_lymphocyte_count_median", "labvalues_absolute_lymphocyte_count_min", "labvalues_absolute_lymphocyte_count_max", "labvalues_absolute_lymphocyte_count_std", "labvalues_absolute_lymphocyte_count_first", "labvalues_absolute_lymphocyte_count_last", "labvalues_absolute_lymphocyte_count_rate_change", "labvalues_absolute_lymphocyte_count_coeff", "labvalues_alanine_aminotransferase_(alt)_mean", "labvalues_alanine_aminotransferase_(alt)_median", "labvalues_alanine_aminotransferase_(alt)_min", "labvalues_alanine_aminotransferase_(alt)_max", "labvalues_alanine_aminotransferase_(alt)_std", "labvalues_alanine_aminotransferase_(alt)_first", "labvalues_alanine_aminotransferase_(alt)_last", "labvalues_alanine_aminotransferase_(alt)_rate_change", "labvalues_alanine_aminotransferase_(alt)_coeff", "labvalues_albumin_mean", "labvalues_albumin_median", "labvalues_albumin_min", "labvalues_albumin_max", "labvalues_albumin_std", "labvalues_albumin_first", "labvalues_albumin_last", "labvalues_albumin_rate_change", "labvalues_albumin_coeff", "labvalues_alkaline_phosphatase_mean", "labvalues_alkaline_phosphatase_median", "labvalues_alkaline_phosphatase_min", "labvalues_alkaline_phosphatase_max", "labvalues_alkaline_phosphatase_std", "labvalues_alkaline_phosphatase_first", "labvalues_alkaline_phosphatase_last", "labvalues_alkaline_phosphatase_rate_change", "labvalues_alkaline_phosphatase_coeff", "labvalues_asparate_aminotransferase_(ast)_mean", "labvalues_asparate_aminotransferase_(ast)_median", "labvalues_asparate_aminotransferase_(ast)_min", "labvalues_asparate_aminotransferase_(ast)_max", "labvalues_asparate_aminotransferase_(ast)_std", "labvalues_asparate_aminotransferase_(ast)_first", "labvalues_asparate_aminotransferase_(ast)_last", "labvalues_asparate_aminotransferase_(ast)_rate_change", "labvalues_asparate_aminotransferase_(ast)_coeff", "labvalues_bands_mean", "labvalues_bands_median", "labvalues_bands_min", "labvalues_bands_max", "labvalues_bands_std", "labvalues_bands_first", "labvalues_bands_last", "labvalues_bands_rate_change", "labvalues_bands_coeff", "labvalues_base_excess_mean", "labvalues_base_excess_median", "labvalues_base_excess_min", "labvalues_base_excess_max", "labvalues_base_excess_std", "labvalues_base_excess_first", "labvalues_base_excess_last", "labvalues_base_excess_rate_change", "labvalues_base_excess_coeff", "labvalues_basophils_mean", "labvalues_basophils_median", "labvalues_basophils_min", "labvalues_basophils_max", "labvalues_basophils_std", "labvalues_basophils_first", "labvalues_basophils_last", "labvalues_basophils_rate_change", "labvalues_basophils_coeff", "labvalues_bicarbonate_mean", "labvalues_bicarbonate_median", "labvalues_bicarbonate_min", "labvalues_bicarbonate_max", "labvalues_bicarbonate_std", "labvalues_bicarbonate_first", "labvalues_bicarbonate_last", "labvalues_bicarbonate_rate_change", "labvalues_bicarbonate_coeff", "labvalues_bilirubin,_direct_mean", "labvalues_bilirubin,_direct_median", "labvalues_bilirubin,_direct_min", "labvalues_bilirubin,_direct_max", "labvalues_bilirubin,_direct_std", "labvalues_bilirubin,_direct_first", "labvalues_bilirubin,_direct_last", "labvalues_bilirubin,_direct_rate_change", "labvalues_bilirubin,_direct_coeff", "labvalues_bilirubin,_total_mean", "labvalues_bilirubin,_total_median", "labvalues_bilirubin,_total_min", "labvalues_bilirubin,_total_max", "labvalues_bilirubin,_total_std", "labvalues_bilirubin,_total_first", "labvalues_bilirubin,_total_last", "labvalues_bilirubin,_total_rate_change", "labvalues_bilirubin,_total_coeff", "labvalues_c-reactive_protein_mean", "labvalues_c-reactive_protein_median", "labvalues_c-reactive_protein_min", "labvalues_c-reactive_protein_max", "labvalues_c-reactive_protein_std", "labvalues_c-reactive_protein_first", "labvalues_c-reactive_protein_last", "labvalues_c-reactive_protein_rate_change", "labvalues_c-reactive_protein_coeff", "labvalues_calcium,_total_mean", "labvalues_calcium,_total_median", "labvalues_calcium,_total_min", "labvalues_calcium,_total_max", "labvalues_calcium,_total_std", "labvalues_calcium,_total_first", "labvalues_calcium,_total_last", "labvalues_calcium,_total_rate_change", "labvalues_calcium,_total_coeff", "labvalues_carboxyhemoglobin_mean", "labvalues_carboxyhemoglobin_median", "labvalues_carboxyhemoglobin_min", "labvalues_carboxyhemoglobin_max", "labvalues_carboxyhemoglobin_std", "labvalues_carboxyhemoglobin_first", "labvalues_carboxyhemoglobin_last", "labvalues_carboxyhemoglobin_rate_change", "labvalues_carboxyhemoglobin_coeff", "labvalues_chloride_mean", "labvalues_chloride_median", "labvalues_chloride_min", "labvalues_chloride_max", "labvalues_chloride_std", "labvalues_chloride_first", "labvalues_chloride_last", "labvalues_chloride_rate_change", "labvalues_chloride_coeff", "labvalues_creatine_kinase_(ck)_mean", "labvalues_creatine_kinase_(ck)_median", "labvalues_creatine_kinase_(ck)_min", "labvalues_creatine_kinase_(ck)_max", "labvalues_creatine_kinase_(ck)_std", "labvalues_creatine_kinase_(ck)_first", "labvalues_creatine_kinase_(ck)_last", "labvalues_creatine_kinase_(ck)_rate_change", "labvalues_creatine_kinase_(ck)_coeff", "labvalues_creatine_kinase,_mb_isoenzyme_mean", "labvalues_creatine_kinase,_mb_isoenzyme_median", "labvalues_creatine_kinase,_mb_isoenzyme_min", "labvalues_creatine_kinase,_mb_isoenzyme_max", "labvalues_creatine_kinase,_mb_isoenzyme_std", "labvalues_creatine_kinase,_mb_isoenzyme_first", "labvalues_creatine_kinase,_mb_isoenzyme_last", "labvalues_creatine_kinase,_mb_isoenzyme_rate_change", "labvalues_creatine_kinase,_mb_isoenzyme_coeff", "labvalues_creatinine_mean", "labvalues_creatinine_median", "labvalues_creatinine_min", "labvalues_creatinine_max", "labvalues_creatinine_std", "labvalues_creatinine_first", "labvalues_creatinine_last", "labvalues_creatinine_rate_change", "labvalues_creatinine_coeff", "labvalues_eosinophils_mean", "labvalues_eosinophils_median", "labvalues_eosinophils_min", "labvalues_eosinophils_max", "labvalues_eosinophils_std", "labvalues_eosinophils_first", "labvalues_eosinophils_last", "labvalues_eosinophils_rate_change", "labvalues_eosinophils_coeff", "labvalues_fibrinogen,_functional_mean", "labvalues_fibrinogen,_functional_median", "labvalues_fibrinogen,_functional_min", "labvalues_fibrinogen,_functional_max", "labvalues_fibrinogen,_functional_std", "labvalues_fibrinogen,_functional_first", "labvalues_fibrinogen,_functional_last", "labvalues_fibrinogen,_functional_rate_change", "labvalues_fibrinogen,_functional_coeff", "labvalues_free_calcium_mean", "labvalues_free_calcium_median", "labvalues_free_calcium_min", "labvalues_free_calcium_max", "labvalues_free_calcium_std", "labvalues_free_calcium_first", "labvalues_free_calcium_last", "labvalues_free_calcium_rate_change", "labvalues_free_calcium_coeff", "labvalues_glucose_mean", "labvalues_glucose_median", "labvalues_glucose_min", "labvalues_glucose_max", "labvalues_glucose_std", "labvalues_glucose_first", "labvalues_glucose_last", "labvalues_glucose_rate_change", "labvalues_glucose_coeff", "labvalues_hematocrit_mean", "labvalues_hematocrit_median", "labvalues_hematocrit_min", "labvalues_hematocrit_max", "labvalues_hematocrit_std", "labvalues_hematocrit_first", "labvalues_hematocrit_last", "labvalues_hematocrit_rate_change", "labvalues_hematocrit_coeff", "labvalues_hemoglobin_mean", "labvalues_hemoglobin_median", "labvalues_hemoglobin_min", "labvalues_hemoglobin_max", "labvalues_hemoglobin_std", "labvalues_hemoglobin_first", "labvalues_hemoglobin_last", "labvalues_hemoglobin_rate_change", "labvalues_hemoglobin_coeff", "labvalues_inr(pt)_mean", "labvalues_inr(pt)_median", "labvalues_inr(pt)_min", "labvalues_inr(pt)_max", "labvalues_inr(pt)_std", "labvalues_inr(pt)_first", "labvalues_inr(pt)_last", "labvalues_inr(pt)_rate_change", "labvalues_inr(pt)_coeff", "labvalues_lactate_mean", "labvalues_lactate_median", "labvalues_lactate_min", "labvalues_lactate_max", "labvalues_lactate_std", "labvalues_lactate_first", "labvalues_lactate_last", "labvalues_lactate_rate_change", "labvalues_lactate_coeff", "labvalues_lymphocytes_mean", "labvalues_lymphocytes_median", "labvalues_lymphocytes_min", "labvalues_lymphocytes_max", "labvalues_lymphocytes_std", "labvalues_lymphocytes_first", "labvalues_lymphocytes_last", "labvalues_lymphocytes_rate_change", "labvalues_lymphocytes_coeff", "labvalues_magnesium_mean", "labvalues_magnesium_median", "labvalues_magnesium_min", "labvalues_magnesium_max", "labvalues_magnesium_std", "labvalues_magnesium_first", "labvalues_magnesium_last", "labvalues_magnesium_rate_change", "labvalues_magnesium_coeff", "labvalues_neutrophils_mean", "labvalues_neutrophils_median", "labvalues_neutrophils_min", "labvalues_neutrophils_max", "labvalues_neutrophils_std", "labvalues_neutrophils_first", "labvalues_neutrophils_last", "labvalues_neutrophils_rate_change", "labvalues_neutrophils_coeff", "labvalues_oxygen_saturation_mean", "labvalues_oxygen_saturation_median", "labvalues_oxygen_saturation_min", "labvalues_oxygen_saturation_max", "labvalues_oxygen_saturation_std", "labvalues_oxygen_saturation_first", "labvalues_oxygen_saturation_last", "labvalues_oxygen_saturation_rate_change", "labvalues_oxygen_saturation_coeff", "labvalues_pt_mean", "labvalues_pt_median", "labvalues_pt_min", "labvalues_pt_max", "labvalues_pt_std", "labvalues_pt_first", "labvalues_pt_last", "labvalues_pt_rate_change", "labvalues_pt_coeff", "labvalues_ptt_mean", "labvalues_ptt_median", "labvalues_ptt_min", "labvalues_ptt_max", "labvalues_ptt_std", "labvalues_ptt_first", "labvalues_ptt_last", "labvalues_ptt_rate_change", "labvalues_ptt_coeff", "labvalues_phosphate_mean", "labvalues_phosphate_median", "labvalues_phosphate_min", "labvalues_phosphate_max", "labvalues_phosphate_std", "labvalues_phosphate_first", "labvalues_phosphate_last", "labvalues_phosphate_rate_change", "labvalues_phosphate_coeff", "labvalues_platelet_count_mean", "labvalues_platelet_count_median", "labvalues_platelet_count_min", "labvalues_platelet_count_max", "labvalues_platelet_count_std", "labvalues_platelet_count_first", "labvalues_platelet_count_last", "labvalues_platelet_count_rate_change", "labvalues_platelet_count_coeff", "labvalues_potassium_mean", "labvalues_potassium_median", "labvalues_potassium_min", "labvalues_potassium_max", "labvalues_potassium_std", "labvalues_potassium_first", "labvalues_potassium_last", "labvalues_potassium_rate_change", "labvalues_potassium_coeff", "labvalues_rdw_mean", "labvalues_rdw_median", "labvalues_rdw_min", "labvalues_rdw_max", "labvalues_rdw_std", "labvalues_rdw_first", "labvalues_rdw_last", "labvalues_rdw_rate_change", "labvalues_rdw_coeff", "labvalues_red_blood_cells_mean", "labvalues_red_blood_cells_median", "labvalues_red_blood_cells_min", "labvalues_red_blood_cells_max", "labvalues_red_blood_cells_std", "labvalues_red_blood_cells_first", "labvalues_red_blood_cells_last", "labvalues_red_blood_cells_rate_change", "labvalues_red_blood_cells_coeff", "labvalues_sodium_mean", "labvalues_sodium_median", "labvalues_sodium_min", "labvalues_sodium_max", "labvalues_sodium_std", "labvalues_sodium_first", "labvalues_sodium_last", "labvalues_sodium_rate_change", "labvalues_sodium_coeff", "labvalues_troponin_t_mean", "labvalues_troponin_t_median", "labvalues_troponin_t_min", "labvalues_troponin_t_max", "labvalues_troponin_t_std", "labvalues_troponin_t_first", "labvalues_troponin_t_last", "labvalues_troponin_t_rate_change", "labvalues_troponin_t_coeff", "labvalues_urea_nitrogen_mean", "labvalues_urea_nitrogen_median", "labvalues_urea_nitrogen_min", "labvalues_urea_nitrogen_max", "labvalues_urea_nitrogen_std", "labvalues_urea_nitrogen_first", "labvalues_urea_nitrogen_last", "labvalues_urea_nitrogen_rate_change", "labvalues_urea_nitrogen_coeff", "labvalues_white_blood_cells_mean", "labvalues_white_blood_cells_median", "labvalues_white_blood_cells_min", "labvalues_white_blood_cells_max", "labvalues_white_blood_cells_std", "labvalues_white_blood_cells_first", "labvalues_white_blood_cells_last", "labvalues_white_blood_cells_rate_change", "labvalues_white_blood_cells_coeff", "labvalues_pco2_mean", "labvalues_pco2_median", "labvalues_pco2_min", "labvalues_pco2_max", "labvalues_pco2_std", "labvalues_pco2_first", "labvalues_pco2_last", "labvalues_pco2_rate_change", "labvalues_pco2_coeff", "labvalues_ph_mean", "labvalues_ph_median", "labvalues_ph_min", "labvalues_ph_max", "labvalues_ph_std", "labvalues_ph_first", "labvalues_ph_last", "labvalues_ph_rate_change", "labvalues_ph_coeff", "deterioration_severe_hypoxemia", "deterioration_ecmo", "deterioration_vasopressors", "deterioration_inotropes", "deterioration_mechanical_ventilation", "deterioration_cardiac_arrest", "deterioration_icu_24h", "deterioration_icu_stay", "deterioration_mortality_1d", "deterioration_mortality_7d", "deterioration_mortality_28d", "deterioration_mortality_90d", "deterioration_mortality_180d", "deterioration_mortality_365d", "deterioration_mortality_stay"]
            col_strings = ["general_file_name", "general_ecg_time", "general_ed_diag_ed", "general_ed_diag_hosp", "general_dod", "general_intime", "general_outtime", "general_race", "general_90min", "general_hosp_dischtime"]
            
            dtype_dict_ints = {c:"int32" for c in col_ints}
            dtype_dict_floats = {c:"float32" for c in col_floats}
            dtype_dict_strs = {c:"str" for c in col_strings}
            dtype_dict_ints.update(dtype_dict_floats)
            dtype_dict_ints.update(dtype_dict_strs)
            #df_diags=pd.read_csv(Path(dataset_kwargs.path)/"mds_ed.csv",dtype={'general_hosp_dischtime': str})#avoid mixed type warning
            df_diags=pd.read_csv(Path(dataset_kwargs.path)/"mds_ed.csv",dtype=dtype_dict_ints)#avoid mixed type warning

            #clean up and set datatypes correctly
            df_diags.drop('Unnamed: 0',axis=1, inplace=True)
            for c in ['general_ecg_time','general_intime','general_outtime','general_hosp_dischtime']:
                df_diags[c] = pd.to_datetime(df_diags[c])
            for c in ['general_ed_diag_ed', 'general_ed_diag_hosp']:
                df_diags[c]=df_diags[c].apply(lambda x: eval(x))

            #map ethnicity to categorical
            lbl_itos_ethnicity=['demographics_ethnicity_asian',
            'demographics_ethnicity_black/african',
            'demographics_ethnicity_hispanic/latino',
            'demographics_ethnicity_other',
            'demographics_ethnicity_white']

            df_diags["demographics_ethnicity"]=df_diags.apply(lambda row: np.where([row[c] for c in lbl_itos_ethnicity])[0][0],axis=1)
            df_diags.drop(lbl_itos_ethnicity,axis=1,inplace=True)

            #fetch input columns
            input_cols = [x for x in df_diags.columns if (x.split("_")[0] in ['biometrics', 'demographics', 'labvalues', 'vitals'])]
            
            #grab training set medians and identify columns with nans
            df_train= df_diags[df_diags.general_strat_fold<18]
            train_medians= df_train[input_cols].median().to_dict()
            train_nans = [l for l,c in df_train[input_cols].isna().sum().to_dict().items() if c>0]

            #impute nans through medians introduce additional column _nan (if desired)
            for c in train_nans:
                if(self.hparams.task.introduce_nan_columns):
                    df_diags[c+"_nan"]=0
                    df_diags.loc[df_diags[c].isna(),c+"_nan"]=1
                df_diags.loc[df_diags[c].isna(),c]=train_medians[c]

            #defragment
            df_diags = df_diags.copy()
            #update input_cols
            input_cols = [x for x in df_diags.columns if (x.split("_")[0] in ['biometrics', 'demographics', 'labvalues', 'vitals'])]

            #get unique entries for all input columns
            unique_counts = {c:len(np.unique(np.array(df_diags[c]))) for c in input_cols}

            #identify continuous and categorical features and print them
            small_cardinality_non_nan_nor_lab = [c for c,v in unique_counts.items() if (v<10 and not c.endswith("nan") and not c.startswith("labvalues"))]#lab values are very sparse- don't want to introduce categorical variables to encode their statistical features
            small_cardinality_nan = [c for c,v in unique_counts.items() if (v<10 and c.endswith("nan"))]
            
            cat_features = small_cardinality_non_nan_nor_lab  + small_cardinality_nan if self.hparams.task.nan_columns_as_cat else small_cardinality_non_nan_nor_lab 
            cat_features_dim = [unique_counts[c] for c in cat_features]
            cont_features = [c for c in input_cols if not c in cat_features]
            print("cat. features:", len(cat_features), "dimensions:", cat_features_dim, "cont. features:",len(cont_features))

            #cleanup map to integers starting at 0
            df_diags["vitals_acuity"]=df_diags["vitals_acuity"].apply(lambda x: int(x)-1)

            #merge feature categories
            df_diags["cat_features"]=df_diags[cat_features].values.tolist()
            df_diags.drop(cat_features,axis=1,inplace=True)
            df_diags["cont_features"]=df_diags[cont_features].values.tolist()
            df_diags.drop(cont_features,axis=1,inplace=True)
            
            #grab diagnostic labels
            lbl_itos_diags = ["_".join(c.split("_")[1:]) for c in df_diags.columns if c.startswith("diagnoses")]
            lbl_itos_diags = sorted(lbl_itos_diags)
            df_diags["label_diag"]=df_diags[["diagnoses_"+c for c in lbl_itos_diags]].values.tolist()
            df_diags.drop(["diagnoses_"+c for c in lbl_itos_diags],axis=1,inplace=True)
            
            #grab deterioration labels
            lbl_itos_deterioration = ["_".join(c.split("_")[1:]) for c in df_diags.columns if c.startswith("deterioration")]
            for c in lbl_itos_deterioration:
                df_diags["deterioration_"+c]  = df_diags["deterioration_"+c].replace(-999., np.nan)#turn -999. into nans
            df_diags["label_deterioration"]=df_diags[["deterioration_"+c for c in lbl_itos_deterioration]].values.tolist()
            df_diags.drop(["deterioration_"+c for c in lbl_itos_deterioration],axis=1,inplace=True)
            
            #merge with original df_mapped (just the data column) just use the general_data column for now
            df_diags.drop("general_data",axis=1,inplace=True)
            df_diags = df_diags.join(df_mapped[["data","study_id"]].set_index("study_id"),on="general_study_id")
            df_diags.columns = [x.replace("general_","") for x in df_diags.columns]

            if(dataset_kwargs.name.endswith("diagnoses")):
                df_diags["label"]=df_diags["label_diag"]
                lbl_itos = lbl_itos_diags
            elif(dataset_kwargs.name.endswith("deterioration")):
                df_diags["label"]=df_diags["label_deterioration"]
                lbl_itos = lbl_itos_deterioration
            df_diags.drop(["label_diag","label_deterioration"], axis=1, inplace=True)
            
            #workaround: remove duplicates
            df_diags = df_diags[~df_diags["data"].duplicated()].copy()

        return df_diags, lbl_itos, mean, std

@dataclass
class TaskConfigMultimodal(TaskConfig):
    mainclass:str= "clinical_ts.task.multimodal.MultimodalModel"
    introduce_nan_columns:bool = False #impute using train set median and introduce an additional column that states if imputation occurred 
    nan_columns_as_cat:bool = False #treat nan columns as categorical variables (instead of continuous)
